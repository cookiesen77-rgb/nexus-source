@tailwind base;
@tailwind components;
@tailwind utilities;

/* Base styles | 基础样式 */
:root {
  font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  line-height: 1.5;
  font-weight: 400;
  font-synthesis: none;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html, body, #root {
  width: 100%;
  height: 100%;
  overflow: hidden;
}

/* Light mode variables | 浅色模式变量 */
:root {
  /* Pencil light minimal */
  --bg-primary: #f8fafc;
  --bg-secondary: #ffffff;
  --bg-tertiary: #f1f5f9;
  --text-primary: #0f172a;
  --text-secondary: #64748b;
  --border-color: #e2e8f0;
  --accent-color: #2563eb;
  --accent-hover: #1d4ed8;
  --accent-rgb: 37 99 235;
  --danger-color: #ef4444;
  --danger-hover: #dc2626;
  --danger-rgb: 239 68 68;
}

/* Dark mode variables | 深色模式变量 */
.dark {
  /* Developer Tool / IDE Dark */
  --bg-primary: #0b1220;
  --bg-secondary: #0f172a;
  --bg-tertiary: #111c2e;
  --text-primary: #f1f5f9;
  --text-secondary: #94a3b8;
  --border-color: #334155;
  --accent-color: #3b82f6;
  --accent-hover: #2563eb;
  --accent-rgb: 59 130 246;
  --danger-color: #f43f5e;
  --danger-hover: #e11d48;
  --danger-rgb: 244 63 94;
}

/* ================================
   AI 助手消息列表性能优化
   ================================ */

/* 消息容器优化 */
.message-item {
  /* 使用 content-visibility 让浏览器跳过屏幕外元素的渲染 */
  content-visibility: auto;
  contain-intrinsic-size: 0 80px;
  /* 不使用 contain，以免影响文本选择 */
}

/* 最后一条消息始终可见（可能正在流式输出） */
.message-item:last-of-type {
  content-visibility: visible;
  contain-intrinsic-size: auto;
}

/* 确保消息内容可以被选择和复制 */
.message-item,
.message-item > div {
  user-select: text !important;
  -webkit-user-select: text !important;
  cursor: text;
}

/* 确保 React Flow 节点内的 textarea 和 input 可以选择文本 */
.react-flow__node textarea,
.react-flow__node input[type="text"],
.react-flow__node .select-text {
  user-select: text !important;
  -webkit-user-select: text !important;
  -moz-user-select: text !important;
  cursor: text;
}

body {
  background-color: var(--bg-primary);
  color: var(--text-primary);
  /* 移除过渡以提升性能 */
}

/* ================================
   Select / Option 深色模式适配
   ================================ */
select {
  background-color: var(--bg-secondary);
  color: var(--text-primary);
}

select option {
  background-color: var(--bg-secondary);
  color: var(--text-primary);
}

/* 深色模式下的 select 样式 */
.dark select {
  background-color: var(--bg-secondary);
  color: var(--text-primary);
  color-scheme: dark;
}

.dark select option {
  background-color: var(--bg-tertiary);
  color: var(--text-primary);
}

/* ================================
   性能优化 - 禁用画布相关的所有过渡
   ================================ */

/* 禁用 React Flow 内的所有 CSS 过渡 */
.react-flow,
.react-flow *,
.react-flow__node,
.react-flow__node *,
.react-flow__edge,
.react-flow__edge *,
.react-flow__viewport,
.react-flow__renderer {
  transition: none !important;
  transition-duration: 0s !important;
  transition-delay: 0s !important;
}

/* GPU 层优化 */
.react-flow__viewport {
  will-change: transform;
  transform-origin: 0 0;
  backface-visibility: hidden;
}

.react-flow__node {
  will-change: transform;
  transform: translateZ(0);
  backface-visibility: hidden;
  contain: layout style;
  overflow: visible !important;
}

/* Canvas layering to reduce compositing cost during pan/zoom */
.canvas-layer {
  contain: paint;
  isolation: isolate;
}

.ui-layer {
  pointer-events: none;
}
.ui-layer > * {
  pointer-events: auto;
}

/* Minimal canvas diagnostics */
.rf-minimal {
  position: relative;
  width: 100%;
  height: 100%;
  overflow: hidden;
  background: var(--bg-primary);
}

.rf-minimal-content {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  will-change: transform;
  background: transparent;
}

.rf-minimal-card {
  min-width: 220px;
  min-height: 120px;
  padding: 16px;
  border-radius: 12px;
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
  color: var(--text-primary);
}

.rf-perf-hud {
  position: fixed;
  top: 10px;
  right: 10px;
  z-index: 99999;
  background: rgba(0, 0, 0, 0.85);
  color: #fff;
  padding: 8px 12px;
  font: 12px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  border-radius: 8px;
}

/* Debug: disable compositor hints */
.rf-no-composite .react-flow__viewport {
  will-change: auto;
  backface-visibility: visible;
}
.rf-no-composite .react-flow__node {
  will-change: auto;
  backface-visibility: visible;
}

/* Improve focus visibility | 提升焦点可见性 */
:focus-visible {
  outline: none;
}

/* Legacy VueFlow overrides removed (React/WebGL canvas now) | 已移除 VueFlow 覆盖（画布迁移到 React/WebGL） */

/* High performance mode for canvas zoom/pan | 画布缩放/平移的高性能模式 */
.high-perf-mode [data-node-id] {
  content-visibility: hidden;
  contain-intrinsic-size: auto 300px auto 200px;
}
.high-perf-mode svg {
  visibility: hidden;
}

/* ================================
   React Flow 样式覆盖
   ================================ */

/* Handle 连接点样式 */
.react-flow__handle {
  width: 10px;
  height: 10px;
  background-color: var(--accent-color);
  border: 2px solid var(--bg-secondary);
  border-radius: 50%;
  z-index: 10;
  transition: transform 0.15s ease, width 0.15s ease, height 0.15s ease;
}

.react-flow__handle:hover {
  width: 14px;
  height: 14px;
  cursor: crosshair;
}

.react-flow__handle-left {
  left: -5px;
}

.react-flow__handle-left:hover {
  left: -7px;
}

.react-flow__handle-right {
  right: -5px;
}

.react-flow__handle-right:hover {
  right: -7px;
}

/* 边的样式 */
.react-flow__edge-path {
  /* 默认态需要清晰可见（浅色主题下 --border-color 对比度过低，用户会误以为 hover 才显示） */
  stroke: var(--text-secondary);
  stroke-width: 2;
  stroke-opacity: 0.55;
}

.dark .react-flow__edge-path {
  stroke-opacity: 0.45;
}

.react-flow__edge.selected .react-flow__edge-path,
.react-flow__edge:hover .react-flow__edge-path {
  stroke: var(--accent-color);
  stroke-width: 3;
}

/* 节点选中样式 */
.react-flow__node.selected {
  box-shadow: none; /* 由节点组件自己控制 */
}

/* MiniMap 样式 */
.react-flow__minimap {
  background-color: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: 8px;
}

/* Controls 样式 */
.react-flow__controls {
  background-color: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.react-flow__controls-button {
  background-color: var(--bg-secondary);
  border-bottom: 1px solid var(--border-color);
  fill: var(--text-secondary);
}

.react-flow__controls-button:hover {
  background-color: var(--bg-tertiary);
}

/* 背景点样式 */
.react-flow__background {
  background-color: var(--bg-primary);
}


/* Reduce work during active pan/zoom/drag */
.rf-moving .react-flow__viewport {
  background-image: none;
}
.rf-moving .react-flow__edges {
  display: none;
}

/* Zoom-only LOD: hide edges/background during zoom (keep nodes) */
.rf-zooming .react-flow__viewport {
  background-image: none;
}
.rf-zooming .react-flow__edges {
  display: none;
}
